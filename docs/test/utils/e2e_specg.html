<!DOCTYPE html>

<html>
<head>
  <title>e2e_specg.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>e2e_specg.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <ul>
<li>e2e_specg.js</li>
<li>e2e_spec actions array generator</li>
<li><p>usage exp:
$ node e2e_specg ../logs/2015-09-18/16-00-04.log0 &gt; 
  ../spec_es6/e2e_spec_2015-09-18-16-00-04.js </p>
</li>
<li><p>@dependencies: ../libs/traceur-runtime, node module fs<br>
@param none<br></p>
</li>
<li><p>NOTE: The modifier for e2e_spec.js the GMT yr-m-d-hour-min-secs which
identifies the log0-file used to generate the e2e_spec.
(../logs/2015-09-18/16-00-04.log0 for exp.)</p>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">

"use strict"</span>;
<span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/traceur-runtime'</span>);

<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">var</span> args = process.argv.slice(<span class="hljs-number">1</span>);
<span class="hljs-keyword">if</span>(!args[<span class="hljs-number">1</span>]){
  process.exit();
}
<span class="hljs-keyword">var</span> filename = args[<span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>prefab strings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> head =  
<span class="hljs-string">`// * e2e_spec.js
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <ul>
<li><p>tests functions causing state change end-to-end using actions
and expected state-change results:
absolute-urls (all url-components present)
delta-urls (only changed url-components present)
timeline (non-trivial only in the case of Camera3d and Camera2d)</p>
</li>
<li><p>@dependencies: none<br>
@param none<br></p>
</li>
<li><p>NOTE: The modifier for e2e_spec.js the GMT yr-m-d-hour-min-secs which
identifies the log0-file used to generate the e2e_spec.
(../logs/2015-09-18/16-00-04.log0 for exp.)</p>
</li>
<li><p>NOTE: This file was auto-generated by test/utils/e2e_specg.js</p>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>

<span class="hljs-keyword">var</span> e2e_spec =  [<span class="hljs-string">`;


fs.readFile(filename, function(err, data) {
    if(err){ throw err;}
    var a = data.toString().split(",\n"),
        cell = {},
        i=0,
        j=0;

</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>console.log(<code>@@@ a.length = ${a.length}</code>);
console.log(<code>@@@ a[0] = ${a[0]}</code>);
console.log(<code>@@@ a[${a.length-1}] = ${a[a.length-1]}</code>);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(a[a.length-<span class="hljs-number">1</span>].length === <span class="hljs-number">0</span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>console.log(“@@@ last element is empty - popping it from array”);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      a.pop(); <span class="hljs-comment">// remove last (empty) el</span>
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>console.log(<code>@@@ a.length = ${a.length}</code>);
console.log(<code>@@@ a[0] = ${a[0]}</code>);
console.log(<code>@@@ a[${a.length-1}] = ${a[a.length-1]}</code>);</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>generate the e2e_spec-array file</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">console</span>.log(head);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> e <span class="hljs-keyword">of</span> a) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>console.log(<code>@@@ TOP i=${i} j=${j}</code>);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(<span class="hljs-regexp">/^\{"t":/</span>.test(e) || <span class="hljs-regexp">/^\{"id":/</span>.test(e)){
        cell.action = e;
      }<span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-regexp">/\/\//</span>.test(e)){
          cell.delta_url = e;
        }<span class="hljs-keyword">else</span>{
          <span class="hljs-keyword">if</span>(<span class="hljs-regexp">/^\{"delta/</span>.test(e) || <span class="hljs-regexp">/{}/</span>.test(e)){
            cell.shot = e;
          }<span class="hljs-keyword">else</span>{
            cell.abs_url = e;
          }
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>write final tail (j===a.length) or 
write close of cell and reset cell for the next cycle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(i===<span class="hljs-number">3</span>){
        <span class="hljs-keyword">if</span>(j===a.length-<span class="hljs-number">1</span>){              
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`{"action": <span class="hljs-subst">${cell.action}</span>,`</span>);
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`"abs_url": <span class="hljs-subst">${cell.abs_url}</span>,`</span>);
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`"delta_url": <span class="hljs-subst">${cell.delta_url}</span>,`</span>);
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`"shot": <span class="hljs-subst">${cell.shot}</span>}];`</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>console.log(<code>@@@ fully complete: j=${j}</code>);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          process.exit();
        }<span class="hljs-keyword">else</span>{
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`{"action": <span class="hljs-subst">${cell.action}</span>,`</span>);
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`"abs_url": <span class="hljs-subst">${cell.abs_url}</span>,`</span>);
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`"delta_url": <span class="hljs-subst">${cell.delta_url}</span>,`</span>);
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`"shot": <span class="hljs-subst">${cell.shot}</span>},`</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>console.log(<code>@@@ cell complete: j=${j}</code>);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          cell = {};
        }
      }
      i = (i+<span class="hljs-number">1</span>)%<span class="hljs-number">4</span>;
      j = j+<span class="hljs-number">1</span>;
    }<span class="hljs-comment">//for</span>
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
